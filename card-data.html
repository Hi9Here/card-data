<link rel="import" href="../mediator-data/mediator-data.html">
<!--
`<card-data cards="{{cards}}" url="{{url}}" user-id="marcus6666"></card-data>` CRUDSSTM for card data

card-dealer

@demo demo.html
-->
<dom-module id="card-data">
  <template>
    <mediator-data id="cards" as-array="{{cards}}" on-put="{{onPut}}" url="{{url}}" folder="{{cardPath}}" default-folder="default/card-data" token="{{token}}"></mediator-data>
    <mediator-data id="share" data="{{shared}}" as-array="{{sharedCards}}" url="{{shareUrl}}" folder="{{cardPath}}" default-folder="default" token="{{token}}"></mediator-data>
    <mediator-data id="players" as-array="{{playerCards}}" url="{{playerUrl}}" folder="{{playerPath}}" token="{{token}}"></mediator-data>
  </template>
</dom-module>
<script>
  Polymer({
    is: "card-data",
    properties: {
      shareUrl: {
        computed: "getShareUrl(url, uid)"
      },
      playerUrl: {
        computed: "getPlayerUrl(url, uid)"
      },
      sharedCards: {
        notify: true
      },
      shared: {
        notify: true
      },
      cards: {
        notify: true
      },
      playerCards: {
        notify: true
      },
      playerPath: {
        computed:"getPlayerPath(uid)"
      },
      cardPath: {
        computed:"getCardPath(uid)"
      },
      /* user token if logged in */
      token: String
    },
    getPlayerUrl: function(url, uid){
      var path = url.split("/")
      return "https://" + path[2] + "/players/"
    },
    getShareUrl: function(url, uid){
      var path = url.split("/")
      return "https://" + path[2] + "/share/"
    },
    getCardPath: function(uid) {
      return uid + "/cards" 
    },
    getPlayerPath: function(uid) {
      return uid + "/players"
    },
    addCard: function(card) {
      if (card && card.title && card.url && card.data) {
        return this.$.cards.push(card)
      }
    },
    deleteCard: function(index) {
      return this.splice("cards", index, 1)
    },
    deal: function(card) {
      if (!this.shared) {
        this.shared = {}
      }
      this.set("shared."+this.hash(card.url), card)
    },
    hash: function(it) {
      return this.$.share.hash(it)
    },
    pushCard: function(it) {
      return this.$.cards.push(it)
    }
  })
</script>
